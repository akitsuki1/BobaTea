@model BobaTea.Models.Products

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Chi tiết sản phẩm";
}

<link rel="stylesheet" href="~/Content/css/produce.css" />

<div class="container mt-4">
    <h2 class="text-center mb-4">🍹 Chi tiết sản phẩm</h2>

    <div class="product-detail"
         data-name="@Model.Name"
         data-price="@Model.Price"
         data-img="@Url.Content(Model.ImageUrl)">
        <img src="@Url.Content(Model.ImageUrl)" alt="@Model.Name" class="product-img" style="width:200px;height:200px;object-fit:cover;border-radius:8px;" />
        <h3 class="product-name">@Model.Name</h3>
        <p class="product-price text-danger fw-bold">@Model.Price.ToString("N0") đ</p>
        <p class="product-desc">@Model.Description</p>

        <!-- Các tùy chọn giống produce.cshtml -->
        <div class="option-group">
            <label><strong>🧋 Chọn topping:</strong></label>
            <select id="detail-topping" class="form-select">
                <option value="">Không thêm</option>
                <option value="Trân châu đen">Trân châu đen</option>
                <option value="Thạch cà phê">Thạch cà phê</option>
                <option value="Pudding trứng">Pudding trứng</option>
                <option value="Xương sáo">Xương sáo</option>
            </select>
        </div>

        <div class="option-group">
            <label><strong>🍬 Lượng đường:</strong></label>
            <select id="detail-sugar" class="form-select">
                <option value="100%">100%</option>
                <option value="75%">75%</option>
                <option value="50%">50%</option>
                <option value="25%">25%</option>
            </select>
        </div>

        <div class="option-group">
            <label><strong>🧊 Lượng đá:</strong></label>
            <select id="detail-ice" class="form-select">
                <option value="100%">100%</option>
                <option value="75%">75%</option>
                <option value="50%">50%</option>
                <option value="25%">25%</option>
                <option value="0%">0%</option>
            </select>
        </div>

        <div class="option-group">
            <label><strong>Số lượng:</strong></label>
            <input type="number" id="detail-qty" min="1" value="1" class="form-control" style="width:80px;">
        </div>

        <div class="mt-3">
            <button id="btnAddToCart" class="btn btn-success">🛒 Thêm vào giỏ</button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function () {
        $("#btnAddToCart").on("click", function () {
            const data = {
                productName: "@Model.Name",
                imageUrl: "@Url.Content(Model.ImageUrl)",
                quantity: parseInt($("#detail-qty").val()) || 1,
                price: @Model.Price,
                topping: $("#detail-topping").val(),
                sugar: $("#detail-sugar").val(),
                ice: $("#detail-ice").val()
            };

            $.ajax({
                url: "/Home/AddToCart",
                type: "POST",
                data: data,
                success: function (res) {
                    if (res.success) {
                        alert(`✅ Đã thêm "${data.productName}" vào giỏ hàng!`);
                    } else {
                        alert("❌ Có lỗi xảy ra khi thêm vào giỏ!");
                    }
                },
                error: function () {
                    alert("⚠️ Lỗi khi gửi yêu cầu tới server!");
                }
            });

            const data = {
                productId: @Model.ProductId, // hoặc product.data("id") nếu lấy từ data attribute
                productName: "@Model.Name",
                imageUrl: "@Url.Content(Model.ImageUrl)",
                quantity: parseInt($("#detail-qty").val()) || 1,
                price: @Model.Price,
                topping: $("#detail-topping").val(),
                sugar: $("#detail-sugar").val(),
                 ice: $("#detail-ice").val()
            };

        });
    });
</script>
